import {Component, ElementRef, OnInit, RendererV2} from '@angular/core';
import {INode} from '../../interfaces/node';
import {split} from 'ts-node/dist';

@Component({
  selector: 'app-render',
  templateUrl: './render.component.html',
  styleUrls: ['./render.component.css']
})
export class RenderComponent implements OnInit {
  private nativeElement: Node;
  private json = '{"tag":"html","children":[{"tag":"body","children":[{"tag":"p","class":"","children":[{"tag":"br"}]},{"tag":"p","class":"","children":[{"tag":"br"}]},{"tag":"p","class":""},{"tag":"p"},{"tag":"div","class":"row pinnable-image-row image-align-center featured-image","style":"display: inline-block","draggable":"true","contenteditable":"false","data-img-id":"postImage3","data-img-original-id":"12187","data-width":"960","data-height":"962","children":[{"tag":"div","class":"image-content-container","children":[{"tag":"div","class":"pin-container cd-product cd-container","children":[{"tag":"div","class":"pin-list cd-product-wrapper","children":[{"tag":"img","dynamicclick":"addNewPin()","id":"postImage3","data-original-id":"12187","class":"post-image","data-id":"3","src":"http:\/\/api-test.bfrow.com\/api\/v\/0.0.2\/images\/url\/960x\/aHR0cDovL3d3dy5zdHJlZXRjaGljdGVsYXZpdi5jb20vd3AtY29udGVudC91cGxvYWRzLzIwMTcvMDEvY29udmVyc2VyZWQxLmpwZw=="},{"tag":"ul","id":"postImage3Ul","class":"pin-point-list"}]}]},{"tag":"figcaption","id":"postImage3Caption","class":"img-caption","data-image-id":"postImage3","placeholder":"Write your image caption here"},{"tag":"ul","id":"postImage3RowsUl","class":"pin-row-list","contenteditable":"false"}]}]},{"tag":"p","children":[{"tag":"br"}]},{"tag":"p"},{"tag":"p"},{"tag":"div","class":"row pinnable-image-row image-align-center ","style":"display: inline-block","draggable":"true","contenteditable":"false","data-img-id":"postImage5","data-img-original-id":"12188","data-width":"960","data-height":"1000","children":[{"tag":"div","class":"image-content-container","children":[{"tag":"div","class":"pin-container cd-product cd-container","children":[{"tag":"div","class":"pin-list cd-product-wrapper","children":[{"tag":"img","dynamicclick":"addNewPin()","id":"postImage5","data-original-id":"12188","class":"post-image","data-id":"5","src":"http:\/\/api-test.bfrow.com\/api\/v\/0.0.2\/images\/url\/960x\/aHR0cDovL3d3dy5zdHJlZXRjaGljdGVsYXZpdi5jb20vd3AtY29udGVudC91cGxvYWRzLzIwMTcvMDEvY29udmVyc2VyZWQzLmpwZw=="},{"tag":"ul","id":"postImage5Ul","class":"pin-point-list"}]}]},{"tag":"figcaption","id":"postImage5Caption","class":"img-caption","data-image-id":"postImage5","placeholder":"Write your image caption here"},{"tag":"ul","id":"postImage5RowsUl","class":"pin-row-list","contenteditable":"false"}]}]},{"tag":"p","children":[{"tag":"br"}]},{"tag":"p"},{"tag":"p"},{"tag":"div","class":"row pinnable-image-row image-align-center ","style":"display: inline-block","draggable":"true","contenteditable":"false","data-img-id":"postImage7","data-img-original-id":"12186","data-width":"960","data-height":"1038","children":[{"tag":"div","class":"image-content-container","children":[{"tag":"div","class":"pin-container cd-product cd-container","children":[{"tag":"div","class":"pin-list cd-product-wrapper","children":[{"tag":"img","dynamicclick":"addNewPin()","id":"postImage7","data-original-id":"12186","class":"post-image","data-id":"7","src":"http:\/\/api-test.bfrow.com\/api\/v\/0.0.2\/images\/url\/960x\/aHR0cDovL3d3dy5zdHJlZXRjaGljdGVsYXZpdi5jb20vd3AtY29udGVudC91cGxvYWRzLzIwMTcvMDEvY29udmVyc2VyZWQ3LmpwZw=="},{"tag":"ul","id":"postImage7Ul","class":"pin-point-list"}]}]},{"tag":"figcaption","id":"postImage7Caption","class":"img-caption","data-image-id":"postImage7","placeholder":"Write your image caption here"},{"tag":"ul","id":"postImage7RowsUl","class":"pin-row-list","contenteditable":"false"}]}]},{"tag":"p","children":[{"tag":"br"}]},{"tag":"p"},{"tag":"p"},{"tag":"div","class":"row pinnable-image-row image-align-center ","style":"display: inline-block","draggable":"true","contenteditable":"false","data-img-id":"postImage9","data-img-original-id":"12189","data-width":"960","data-height":"969","children":[{"tag":"div","class":"image-content-container","children":[{"tag":"div","class":"pin-container cd-product cd-container","children":[{"tag":"div","class":"pin-list cd-product-wrapper","children":[{"tag":"img","dynamicclick":"addNewPin()","id":"postImage9","data-original-id":"12189","class":"post-image","data-id":"9","src":"http:\/\/api-test.bfrow.com\/api\/v\/0.0.2\/images\/url\/960x\/aHR0cDovL3d3dy5zdHJlZXRjaGljdGVsYXZpdi5jb20vd3AtY29udGVudC91cGxvYWRzLzIwMTcvMDEvY29udmVyc2VyZWQ0LmpwZw=="},{"tag":"ul","id":"postImage9Ul","class":"pin-point-list"}]}]},{"tag":"figcaption","id":"postImage9Caption","class":"img-caption","data-image-id":"postImage9","placeholder":"Write your image caption here"},{"tag":"ul","id":"postImage9RowsUl","class":"pin-row-list","contenteditable":"false"}]}]},{"tag":"p","children":[{"tag":"br"}]},{"tag":"p"},{"tag":"p"},{"tag":"div","class":"row pinnable-image-row image-align-center ","style":"display: inline-block","draggable":"true","contenteditable":"false","data-img-id":"postImage11","data-img-original-id":"12192","data-width":"960","data-height":"1239","children":[{"tag":"div","class":"image-content-container","children":[{"tag":"div","class":"pin-container cd-product cd-container","children":[{"tag":"div","class":"pin-list cd-product-wrapper","children":[{"tag":"img","dynamicclick":"addNewPin()","id":"postImage11","data-original-id":"12192","class":"post-image","data-id":"11","src":"http:\/\/api-test.bfrow.com\/api\/v\/0.0.2\/images\/url\/960x\/aHR0cDovL3d3dy5zdHJlZXRjaGljdGVsYXZpdi5jb20vd3AtY29udGVudC91cGxvYWRzLzIwMTcvMDEvY29udmVyc2VyZWQyLmpwZw=="},{"tag":"ul","id":"postImage11Ul","class":"pin-point-list"}]}]},{"tag":"figcaption","id":"postImage11Caption","class":"img-caption","data-image-id":"postImage11","placeholder":"Write your image caption here"},{"tag":"ul","id":"postImage11RowsUl","class":"pin-row-list","contenteditable":"false"}]}]},{"tag":"p","children":[{"tag":"br"}]},{"tag":"p"},{"tag":"p"},{"tag":"div","class":"row pinnable-image-row image-align-center ","style":"display: inline-block","draggable":"true","contenteditable":"false","data-img-id":"postImage13","data-img-original-id":"12190","data-width":"960","data-height":"652","children":[{"tag":"div","class":"image-content-container","children":[{"tag":"div","class":"pin-container cd-product cd-container","children":[{"tag":"div","class":"pin-list cd-product-wrapper","children":[{"tag":"img","dynamicclick":"addNewPin()","id":"postImage13","data-original-id":"12190","class":"post-image","data-id":"13","src":"http:\/\/api-test.bfrow.com\/api\/v\/0.0.2\/images\/url\/960x\/aHR0cDovL3d3dy5zdHJlZXRjaGljdGVsYXZpdi5jb20vd3AtY29udGVudC91cGxvYWRzLzIwMTcvMDEvY29udmVyc2VyZWQ2LmpwZw=="},{"tag":"ul","id":"postImage13Ul","class":"pin-point-list"}]}]},{"tag":"figcaption","id":"postImage13Caption","class":"img-caption","data-image-id":"postImage13","placeholder":"Write your image caption here"},{"tag":"ul","id":"postImage13RowsUl","class":"pin-row-list","contenteditable":"false"}]}]},{"tag":"p","children":[{"tag":"br"}]},{"tag":"p"},{"tag":"p"},{"tag":"div","class":"row pinnable-image-row image-align-center ","style":"display: inline-block","draggable":"true","contenteditable":"false","data-img-id":"postImage15","data-img-original-id":"12191","data-width":"960","data-height":"971","children":[{"tag":"div","class":"image-content-container","children":[{"tag":"div","class":"pin-container cd-product cd-container","children":[{"tag":"div","class":"pin-list cd-product-wrapper","children":[{"tag":"img","dynamicclick":"addNewPin()","id":"postImage15","data-original-id":"12191","class":"post-image","data-id":"15","src":"http:\/\/api-test.bfrow.com\/api\/v\/0.0.2\/images\/url\/960x\/aHR0cDovL3d3dy5zdHJlZXRjaGljdGVsYXZpdi5jb20vd3AtY29udGVudC91cGxvYWRzLzIwMTcvMDEvY29udmVyc2VyZWQ1LmpwZw=="},{"tag":"ul","id":"postImage15Ul","class":"pin-point-list"}]}]},{"tag":"figcaption","id":"postImage15Caption","class":"img-caption","data-image-id":"postImage15","placeholder":"Write your image caption here"},{"tag":"ul","id":"postImage15RowsUl","class":"pin-row-list","contenteditable":"false"}]}]},{"tag":"p","children":[{"tag":"br"}]},{"tag":"p"},{"tag":"p","html":"jacket Zara \/\/ hoodie Hanes \/\/ shoes Converse \/\/ hat Shein"},{"tag":"p","html":"I found these shoes online at a website called Forzeiri and once I saw that they were limited edition Converse I knew that I had to order them and quick before they would sell out and there would be no more. I love living in Israel but one thing that I absolutely hate is the online shopping\u00a0and the mail in general. I don\u00e2\u0080\u0099t know how it works in other countries but in the US you can order online so easily, not pay any taxes and most of the time its free shipping. Let\u00e2\u0080\u0099s just say, if I would have ordered these shoes to my apartment in Tel Aviv I would\u00e2\u0080\u0099ve paid forty\u00a0percent more because of taxes and shipping (not exaggerating) and gotten the shoes a month later. Instead, I had them shipped\u00a0to my parents house in America for free, they arrived in three days and luckily someone came to visit me and brought them over. But I have high hopes for the future of Israel:) Anyway, hope you love the outfit and until next time! xx Karen"},{"tag":"p","class":"medium-insert-active","html":"\u00a0"}]}]}';
  public data: INode;
  constructor(private renderer: RendererV2, private element: ElementRef) {
    this.nativeElement = element.nativeElement;
  }

  ngOnInit() {
    this.data = JSON.parse(this.json);
    const el = this.parse(this.data);
    this.renderer.appendChild(this.nativeElement, el);
  }

  parse(node: INode){
    const nativeElement = this.renderer.createElement(node.tag);
    if (node.class){
      node.class.split(' ').filter(i=>!!i).forEach(class_name=>this.renderer.addClass(nativeElement, class_name));
    }
    Object.keys(node).filter(key => ['children', 'class', 'tag'].indexOf(key) === -1).forEach(key => {
      this.renderer.setAttribute(nativeElement, key, node[key]);
    });
    if (node.children && (node.children).length){
      node.children
        .map(item => this.parse(item))
        .map(el => this.renderer.appendChild(nativeElement, el));
    }
    return nativeElement;
  }

}
